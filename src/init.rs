use super::belt::*;
use super::cell::*;
use super::cli_serialize::*;
use super::direction::*;
use super::factory::*;
use super::floor::*;
use super::offer::*;
use super::options::*;
use super::machine::*;
use super::part::*;
use super::port::*;
use super::port_auto::*;
use super::prio::*;
use super::state::*;
use super::utils::*;

pub fn init() -> ( Options, State, Factory ) {

  // Static state configuration (can still be changed by user)
  let mut options = create_options(1.0);

  // General app state
  let mut state = State {
    paused: false,
    reset_next_frame: false,
    mouse_mode_erasing: false,
    mouse_mode_selecting: false,
    selected_area_copy: vec!(),
    available_resources: vec!(),
    test: false,
  };

  // let map = "\
  //   ...............s.\n\
  //   sb.111bbbbbbbb.b.\n\
  //   .b.111.......b.b.\n\
  //   .b.111bbbbb..bbb.\n\
  //   .b.b.b....bb...b.\n\
  //   .b.b.bbbb..b...b.\n\
  //   .b.b....b..b...b.\n\
  //   .bbb...222.b...b.\n\
  //   ...b...222.b..bb.\n\
  //   sbbb...222.b..b..\n\
  //   ........b..b..bbs\n\
  //   ..bbbbbbb..b.....\n\
  //   ..b.....b..bbbbbd\n\
  //   ..b.....b........\n\
  //   dbb..bbbb........\n\
  //   .....b...........\n\
  //   .....d...........\n\
  //   m1 = ws -> b s:10\n\
  //   m2 = b -> g s:10\n\
  //   s1 = w s:10 c:5\n\
  //   s2 = w s:10 c:5\n\
  //   s3 = s s:10 c:5\n\
  //   s4 = s s:10 c:5\n\
  //   d1 = s\n\
  //   d2 = w\n\
  //   d3 = g\n\
  //   d4 = g\n\
  //   os = w s:10 c:5\n\
  //   os = s s:10 c:5\n\
  //   od = g\n\
  //   om = sw -> b s:10 d:3x2\n\
  //   om = b -> g s:10\n\
  //   om = b -> g s:10 d:3x3\n\
  //   om = b -> g s:10 d:4x4\n\
  // ";
  let map = "\
    d=17x17\n\
    ┌─────────────────────────────────────────────────┐\n\
    │.  .  .  .  .  .  .  .  .  .  .  .  .  .  .  sw .│\n\
    │ ┌───────────────────────────────────────────v─┐ │\n\
    │ │         ┌─┐                               v │ │\n\
    │s>>╗  .  . │1<<═<<═<<═<<═<<═<<═<<═<<═<<╗  .  ║ │.│\n\
    │s│ v       │ │                         ^     v │ │\n\
    │ │ v       │ │                         ^     v │ │\n\
    │.│ ║  .  . │1│ .  .  .  .  .  .  .  .  ║  .  ║ │.│\n\
    │ │ v       │ │                         ^     v │ │\n\
    │ │ v       │ │                         ^     v │ │\n\
    │.│ ║  .  ╔>>1>>╦>>═>>═>>═>>═>>╗  .  .  ╚<<═<<╣ │.│\n\
    │ │ v     ^ └─┘ v              v              ^ │ │\n\
    │ │ v     ^     v              v              ^ │ │\n\
    │.│ ║  .  ║  .  ║  .  .  .  .  ╚>>╗  .  .  .  ║ │.│\n\
    │ │ v     ^     v                 v           ^ │ │\n\
    │ │ v     ^     v                 v           ^ │ │\n\
    │.│ ║  .  ║  .  ╚>>═>>═>>╗  .  .  ║  .  .  .  ║ │.│\n\
    │ │ v     ^              v        v           ^ │ │\n\
    │ │ v     ^              v        v           ^ │ │\n\
    │.│ ║  .  ║  .  .  .  .  ║  .  .  ║  .  .  .  ║ │.│\n\
    │ │ v     ^              v        v           ^ │ │\n\
    │ │ v     ^             ┌v┐       v           ^ │ │\n\
    │.│ ╚>>═>>╬<<╗  .  .  . │4│ .  .  ║  .  .  .  ║ │.│\n\
    │ │       ^  ^          │ │       v           ^ │ │\n\
    │ │       ^  ^          │ │       v           ^ │ │\n\
    │.│ .  .  ║  ║  .  .  . │4│ .  .  ║  .  .  ╔>>╝ │.│\n\
    │ │       ^  ^          │ │       v        ^    │ │\n\
    │ │       ^  ^          │ │       v        ^    │ │\n\
    │s>>═>>═>>╩>>╝  .  .  . │4│ .  .  ║  .  .  ║  . │.│\n\
    │w│                     └v┘       v        ^    │ │\n\
    │ │                      v       ┌v┐       ^    │ │\n\
    │.│ .  .  .  .  .  .  .  ║  .  . │3│ .  .  ╚<<═<<s│\n\
    │ │                      v       │ │            │s│\n\
    │ │                      v       │ │            │ │\n\
    │.│ .  ╔<<═<<═<<═<<═<<═<<╣  .  . │3│ .  .  .  . │.│\n\
    │ │    v                 v       │ │            │ │\n\
    │ │    v                 v       │ │            │ │\n\
    │.│ .  ║  .  .  .  .  .  ║  .  . │3>>═>>═>>═>>═>>d│\n\
    │ │    v                 v       └─┘            │g│\n\
    │ │    v                 v                      │ │\n\
    │.│ .  ║  .  .  .  .  .  ║  .  .  .  .  .  .  . │.│\n\
    │ │    v                 v                      │ │\n\
    │ │    v                 v                      │ │\n\
    │d<<═<<╝  .  .  ╔<<═<<═<<╝  .  .  .  .  .  .  . │.│\n\
    │g│             v                               │ │\n\
    │ │             v                               │ │\n\
    │.│ .  .  .  .  ║  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │             v                               │ │\n\
    │ └─────────────v───────────────────────────────┘ │\n\
    │.  .  .  .  .  dg .  .  .  .  .  .  .  .  .  .  .│\n\
    └─────────────────────────────────────────────────┘\n\
    s1 = w s:0 c:100\n\
    s2 = s s:0 c:100\n\
    m1 = s w w -> b s:500\n\
    m4 = b b b -> g s:500\n\
    s3 = w s:0 c:100\n\
    m3 = b b b -> g s:500\n\
    s4 = s s:0 c:100\n\
    d1\n\
    d2\n\
    d3\n\
    os = w s:2000 c:100\n\
    os = s s:2000 c:100\n\
    od\n\
    om = s . . w . . . . . . . . . . . . . . . . . . . . . -> t s:2000 d:5x5\n\
    om = s w w -> b s:500 d:1x3\n\
    om = g g g -> b s:500 d:1x3\n\
    om = b . . . . . . . -> t s:2000 d:4x2\n\
  ";
  // let map = "\
  //   d=17x17\n\
  //   ┌─────────────────────────────────────────────────┐\n\
  //   │.  .  .  .  .  .  .  .  .  .  .  .  .  .  .  sw .│\n\
  //   │ ┌───────────────────────────────────────────v─┐ │\n\
  //   │ │         ┌─┐                               v │ │\n\
  //   │s>>╗  .  . │1<<═<<═<<═<<═<<═<<═<<═<<═<<╗  ╔>>╣ │.│\n\
  //   │s│ v       │ │                         ^  ^  v │ │\n\
  //   │ │ v       │ │                         ^  ^  v │ │\n\
  //   │.│ ║  .  . │1│ .  .  .  .  .  .  .  .  ╠<<╩<<╣ │.│\n\
  //   │ │ v       │ │                         ^     v │ │\n\
  //   │ │ v       │ │                         ^     v │ │\n\
  //   │.│ ║  .  ╔>>1>>╦>>═>>═>>═>>═>>╗  .  .  ╚<<═<<╣ │.│\n\
  //   │ │ v     ^ └─┘ v              v              ^ │ │\n\
  //   │ │ v     ^     v              v              ^ │ │\n\
  //   │.│ ║  .  ║  .  ║  .  .  .  .  ╚>>╗  .  .  .  ║ │.│\n\
  //   │ │ v     ^     v                 v           ^ │ │\n\
  //   │ │ v     ^     v                 v           ^ │ │\n\
  //   │.│ ║  .  ║  .  ╚>>═>>═>>╗  .  .  ║  .  .  .  ║ │.│\n\
  //   │ │ v     ^              v        v           ^ │ │\n\
  //   │ │ v     ^              v        v           ^ │ │\n\
  //   │.│ ║  .  ║  .  .  .  .  ║  .  .  ║  .  .  .  ║ │.│\n\
  //   │ │ v     ^              v        v           ^ │ │\n\
  //   │ │ v     ^             ┌v┐       v           ^ │ │\n\
  //   │.│ ╚>>═>>╬<<╗  .  .  . │2│ .  .  ║  .  .  .  ║ │.│\n\
  //   │ │       ^  ^          │ │       v           ^ │ │\n\
  //   │ │       ^  ^          │ │       v           ^ │ │\n\
  //   │.│ .  .  ║  ║  .  .  . │2│ .  .  ║  .  .  ╔>>╝ │.│\n\
  //   │ │       ^  ^          │ │       v        ^    │ │\n\
  //   │ │       ^  ^          │ │       v        ^    │ │\n\
  //   │s>>═>>═>>╩>>╝  .  .  . │2│ .  .  ║  .  .  ║  . │.│\n\
  //   │w│                     └v┘       v        ^    │ │\n\
  //   │ │                      v        v        ^    │ │\n\
  //   │.│ .  .  .  .  .  .  .  ║  .  .  ║  .  .  ╚<<═<<s│\n\
  //   │ │                      v        v             │s│\n\
  //   │ │                      v        v ┌─┐         │ │\n\
  //   │.│ .  ╔<<═<<═<<═<<═<<═<<╣  .  .  ╚>>3│ .  .  . │.│\n\
  //   │ │    v                 v          │ │         │ │\n\
  //   │ │    v                 v          │ │         │ │\n\
  //   │.│ .  ║  .  .  .  .  .  ║  .  .  . │3>>═>>═>>═>>d│\n\
  //   │ │    v                 v          │ │         │g│\n\
  //   │ │    v                 v          │ │         │ │\n\
  //   │.│ .  ║  .  .  .  .  .  ║  .  .  . │3│ .  .  . │.│\n\
  //   │ │    v                 v          └─┘         │ │\n\
  //   │ │    v                 v                      │ │\n\
  //   │d<<═<<╝  .  .  ╔<<═<<═<<╝  .  .  .  .  .  .  . │.│\n\
  //   │g│             v                               │ │\n\
  //   │ │             v                               │ │\n\
  //   │.│ .  .  .  .  ║  .  .  .  .  .  .  .  .  .  . │.│\n\
  //   │ │             v                               │ │\n\
  //   │ └─────────────v───────────────────────────────┘ │\n\
  //   │.  .  .  .  .  dg .  .  .  .  .  .  .  .  .  .  .│\n\
  //   └─────────────────────────────────────────────────┘\n\
  //   s1 = w s:0 c:100\n\
  //   s2 = s s:0 c:100\n\
  //   m1 = s w w -> b s:500\n\
  //   m2 = b b b -> g s:500\n\
  //   s3 = w s:0 c:100\n\
  //   s4 = s s:0 c:100\n\
  //   m3 = b b b -> g s:500\n\
  //   d1 = g\n\
  //   d2 = g\n\
  //   d3 = g\n\
  //   os = w s:2000 c:100\n\
  //   os = s s:2000 c:100\n\
  //   od = g\n\
  //   od = b\n\
  //   om = s . . w . . -> b s:2000 d:3x2\n\
  //   om = s w w -> b s:500 d:1x3\n\
  //   om = b b b -> g s:500 d:1x3\n\
  //   om = b . . . . . . . . -> g s:1000 d:3x3\n\
  //   om = b . . . . . . . -> g s:2000 d:1x1\n\
  // ";

  let mut factory = create_factory(&mut options, &mut state, map.to_string());
  factory.changed = true;

  return ( options, state, factory );
}
