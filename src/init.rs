use super::belt::*;
use super::cell::*;
use super::cli_serialize::*;
use super::direction::*;
use super::factory::*;
use super::floor::*;
use super::offer::*;
use super::options::*;
use super::machine::*;
use super::part::*;
use super::port::*;
use super::port_auto::*;
use super::prio::*;
use super::state::*;
use super::utils::*;

pub fn init() -> ( Options, State, Factory ) {

  // Static state configuration (can still be changed by user)
  let mut options = create_options(1.0);

  // General app state
  let mut state = State {
    paused: false,
    reset_next_frame: false,
    mouse_mode_erasing: false,
    mouse_mode_selecting: false,
    selected_area_copy: vec!(),
    test: false,
  };

  let map = "\
    ...............s.\n\
    sb.111bbbbbbbb.b.\n\
    .b.111.......b.b.\n\
    .b.111bbbbb..bbb.\n\
    .b.b.b....bb...b.\n\
    .b.b.bbbb..b...b.\n\
    .b.b....b..b...b.\n\
    .bbb...222.b...b.\n\
    ...b...222.b..bb.\n\
    sbbb...222.b..b..\n\
    ........b..b..bbs\n\
    ..bbbbbbb..b.....\n\
    ..b.....b..bbbbbd\n\
    ..b.....b........\n\
    dbb..bbbb........\n\
    .....b...........\n\
    .....d...........\n\
    m1 = ws -> b s:10\n\
    m2 = b -> g s:10\n\
    s1 = w s:10 c:5\n\
    s2 = w s:10 c:5\n\
    s3 = s s:10 c:5\n\
    s4 = s s:10 c:5\n\
    d1 = s\n\
    d2 = w\n\
    d3 = g\n\
    d4 = g\n\
    os = w s:10 c:5\n\
    os = s s:10 c:5\n\
    od = g\n\
    om = sw -> b s:10 d:3x2\n\
    om = b -> g s:10\n\
    om = b -> g s:10 d:3x3\n\
    om = b -> g s:10 d:4x4\n\
  ";
  let map = "\
    d=17x17\n\
    ┌─────────────────────────────────────────────────┐\n\
    │.  .  .  .  .  .  .  .  .  .  .  .  .  .  .  sw .│\n\
    │ ┌───────────────────────────────────────────v─┐ │\n\
    │ │      ┌───────┐                            v │ │\n\
    │s>>╗  . │1  1  1<<═<<═<<═<<═<<═<<═<<═<<╗  .  ║ │.│\n\
    │w│ v    │       │                      ^     v │ │\n\
    │ │ v    │       │                      ^     v │ │\n\
    │.│ ║  . │1  1  1│ .  .  .  .  .  .  .  ║  .  ║ │.│\n\
    │ │ v    │       │                      ^     v │ │\n\
    │ │ v    │       │                      ^     v │ │\n\
    │.│ ║  . │1  1  1>>═>>═>>═>>═>>╗  .  .  ╚<<═<<╣ │.│\n\
    │ │ v    └^─────v┘             v              ^ │ │\n\
    │ │ v     ^     v              v              ^ │ │\n\
    │.│ ║  .  ║  .  ║  .  .  .  .  ╚>>╗  .  .  .  ║ │.│\n\
    │ │ v     ^     v                 v           ^ │ │\n\
    │ │ v     ^     v                 v           ^ │ │\n\
    │.│ ║  .  ║  .  ╚>>═>>═>>╗  .  .  ║  .  .  .  ║ │.│\n\
    │ │ v     ^              v        v           ^ │ │\n\
    │ │ v     ^              v        v           ^ │ │\n\
    │.│ ║  .  ║  .  .  .  .  ║  .  .  ║  .  .  .  ║ │.│\n\
    │ │ v     ^              v        v           ^ │ │\n\
    │ │ v     ^          ┌───v───┐    v           ^ │ │\n\
    │.│ ╚>>═>>╣  .  .  . │2  2  2│ .  ║  .  .  .  ║ │.│\n\
    │ │       ^          │       │    v           ^ │ │\n\
    │ │       ^          │       │    v           ^ │ │\n\
    │.│ .  .  ║  .  .  . │2  2  2│ .  ║  .  .  ╔>>╝ │.│\n\
    │ │       ^          │       │    v        ^    │ │\n\
    │ │       ^          │       │    v        ^    │ │\n\
    │s>>═>>═>>╝  .  .  . │2  2  2│ .  ║  .  .  ║  . │.│\n\
    │s│                  └───v───┘    v        ^    │ │\n\
    │ │                      v        v        ^    │ │\n\
    │.│ .  .  .  .  .  .  .  ║  .  .  ║  .  .  ╚<<═<<s│\n\
    │ │                      v        v             │s│\n\
    │ │                      v        v             │ │\n\
    │.│ .  ╔<<═<<═<<═<<═<<═<<╣  .  .  ║  .  .  .  . │.│\n\
    │ │    v                 v        v             │ │\n\
    │ │    v                 v        v             │ │\n\
    │.│ .  ║  .  .  .  .  .  ║  .  .  ╚>>═>>═>>═>>═>>d│\n\
    │ │    v                 v                      │s│\n\
    │ │    v                 v                      │ │\n\
    │.│ .  ║  .  .  .  .  .  ║  .  .  .  .  .  .  . │.│\n\
    │ │    v                 v                      │ │\n\
    │ │    v                 v                      │ │\n\
    │d<<═<<╝  .  .  ╔<<═<<═<<╝  .  .  .  .  .  .  . │.│\n\
    │s│             v                               │ │\n\
    │ │             v                               │ │\n\
    │.│ .  .  .  .  ║  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │             v                               │ │\n\
    │ └─────────────v───────────────────────────────┘ │\n\
    │.  .  .  .  .  dw .  .  .  .  .  .  .  .  .  .  .│\n\
    └─────────────────────────────────────────────────┘\n\
    s1 = w s:0 c:1\n\
    s2 = w s:0 c:1\n\
    m1 = w s   -> b s:1\n\
    m2 = b     -> g s:1\n\
    s3 = s s:0 c:1\n\
    s4 = s s:0 c:1\n\
    d1 = b\n\
    d2 = g\n\
    d3 = g\n\
    os = w s:10 c:5\n\
    os = s s:10 c:5\n\
    od = g\n\
    om = s w   -> b s:0 d:3x2\n\
    om = b     -> g s:10 d:1x1\n\
    om = b     -> g s:0 d:3x3\n\
    om = b     -> g s:0 d:4x4\n\
  ";
  let map = "\
    d=17x17\n\
    ┌─────────────────────────────────────────────────┐\n\
    │.  .  .  .  .  .  .  .  .  .  .  .  sw ss .  .  .│\n\
    │ ┌──────────────────────────────────v──v───────┐ │\n\
    │ │                                  v  v       │ │\n\
    │.│ .  .  .  .  .  .  .  .  .  .  .  ║  ║  .  . │.│\n\
    │ │                                  v  v       │ │\n\
    │ │                                 ┌v──v───┐   │ │\n\
    │.│ .  .  .  .  .  .  .  .  .  .  . │4  4  4│ . │.│\n\
    │ │                                 │       │   │ │\n\
    │ │   ┌───────┐                     │       │   │ │\n\
    │s>>═>>1  1  1│ .  .  .  .  .  .  . │4  4  4│ . │.│\n\
    │w│   │       │                     └v──v──v┘   │ │\n\
    │ │   │       │                      v  v  v    │ │\n\
    │s>>═>>1  1  1│ .  .  .  .  .  .  .  ║  ║  ║  . │.│\n\
    │s│   └v──v──v┘                      v  v  v    │ │\n\
    │ │    v  v  v                       v  v  v    │ │\n\
    │.│ .  ║  ║  ║  .  .  .  .  .  .  .  ║  ║  ║  . │.│\n\
    │ │    v  v  v                       v  v  v    │ │\n\
    │ │    v  v  v                      ┌v──v──v┐   │ │\n\
    │.│ .  ║  ║  ║  .  .  .  .  .  .  . │5  5  5│ . │.│\n\
    │ │    v  v  v                      │       │   │ │\n\
    │ │   ┌v──v──v┐                     │       │   │ │\n\
    │.│ . │2  2  2│ .  .  .  .  .  .  . │5  5  5>>═>>d│\n\
    │ │   │       │                     │       │   │g│\n\
    │ │   │       │                     │       │   │ │\n\
    │.│ . │2  2  2│ .  .  .  .  .  .  . │5  5  5│ . │.│\n\
    │ │   │       │                     └───────┘   │ │\n\
    │ │   │       │                                 │ │\n\
    │.│ . │2  2  2│ .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │   └v──v──v┘                                 │ │\n\
    │ │    v  v  v                                  │ │\n\
    │.│ .  ║  ║  ║  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │    v  v  v                                  │ │\n\
    │ │    v  v  v                                  │ │\n\
    │.│ .  ║  ║  ║  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │    v  v  v                                  │ │\n\
    │ │    v  v  v                                  │ │\n\
    │.│ .  ║  ║  ║  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │    v  v  v                                  │ │\n\
    │ │    v  v  v                                  │ │\n\
    │.│ .  ║  ║  ║  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │    v  v  v                                  │ │\n\
    │ │    v  v  v                                  │ │\n\
    │.│ .  ║  ║  ║  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │    v  v  v                                  │ │\n\
    │ │    v  v  v                                  │ │\n\
    │.│ .  ║  ║  ║  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │    v  v  v                                  │ │\n\
    │ └────v──v──v──────────────────────────────────┘ │\n\
    │.  .  dg dg dg .  .  .  .  .  .  .  .  .  .  .  .│\n\
    └─────────────────────────────────────────────────┘\n\
    s1 = w s:0 c:1\n\
    s2 = s s:0 c:1\n\
    m4 = s w   -> b s:0\n\
    s3 = w s:0 c:1\n\
    m1 = s w   -> b s:0\n\
    s4 = s s:0 c:1\n\
    m5 = b     -> g s:0\n\
    m2 = b     -> g s:0\n\
    d1 = g\n\
    d2 = g\n\
    d3 = g\n\
    d4 = g\n\
    os = w s:10 c:5\n\
    os = s s:10 c:5\n\
    od = g\n\
    om = s w   -> b s:0 d:3x2\n\
    om = b     -> g s:10 d:1x1\n\
    om = b     -> g s:0 d:3x3\n\
    om = b     -> g s:10000 d:4x4\n\
  ";
  let map = "\
    d=17x17\n\
    ┌─────────────────────────────────────────────────┐\n\
    │.  .  dt dt dt .  .  .  .  .  .  .  .  .  .  .  .│\n\
    │ ┌────^──^──^──────────────────────────────────┐ │\n\
    │ │    ^  ^  ^                                  │ │\n\
    │.│ .  ║  ║  ║  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │    ^  ^  ^                                  │ │\n\
    │ │    ^  ^  ^                                  │ │\n\
    │.│ .  ║  ║  ║  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │    ^  ^  ^                                  │ │\n\
    │ │   ┌^──^──^┐         ┌──────────┐            │ │\n\
    │s>>═>>1  1  1>>═>>═>>═>>2  2  2  2>>═>>═>>═>>═>>d│\n\
    │w│   │       │         │          │            │t│\n\
    │ │   │       │         │          │            │ │\n\
    │s>>═>>1  1  1>>═>>═>>═>>2  2  2  2>>═>>═>>═>>═>>d│\n\
    │s│   └v──v──v┘         │          │            │t│\n\
    │ │    v  v  v          │          │            │ │\n\
    │.│ .  ║  ║  ║  .  .  . │2  2  2  2│ .  .  .  . │.│\n\
    │ │    v  v  v          │          │            │ │\n\
    │ │    v  v  v          │          │            │ │\n\
    │.│ ╔<<╝  ║  ║  .  .  . │2  2  2  2│ .  .  .  . │.│\n\
    │ │ v     v  v          └──────────┘            │ │\n\
    │ │ v     v  v                                  │ │\n\
    │d<<╝  ╔<<╝  ║  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │t│    v     ^                                  │ │\n\
    │ │    v     ^                                  │ │\n\
    │d<<═<<╝  ╔>>╝  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │t│       ^                                     │ │\n\
    │ │       ^                                     │ │\n\
    │d<<═<<═>>╝  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │t│                                             │ │\n\
    │ │                                             │ │\n\
    │.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │                                             │ │\n\
    │ │                                             │ │\n\
    │.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │                                             │ │\n\
    │ │                                             │ │\n\
    │.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │                                             │ │\n\
    │ │                                             │ │\n\
    │.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │                                             │ │\n\
    │ │                                             │ │\n\
    │.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │                                             │ │\n\
    │ │                                             │ │\n\
    │.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
    │ │                                             │ │\n\
    │ └─────────────────────────────────────────────┘ │\n\
    │.  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .│\n\
    └─────────────────────────────────────────────────┘\n\
    d1 = t\n\
    d2 = t\n\
    d3 = t\n\
    s1 = w s:0 c:1\n\
    m1 = s w   -> b s:0\n\
    m2 = b     -> g s:5000\n\
    d4 = t\n\
    s2 = s s:0 c:1\n\
    d5 = t\n\
    d6 = t\n\
    d7 = t\n\
    d8 = t\n\
    os = w s:10 c:5\n\
    os = s s:10 c:5\n\
    od = g\n\
    om = s w   -> b s:0 d:3x2\n\
    om = b     -> g s:10 d:1x1\n\
    om = b     -> g s:0 d:3x3\n\
    om = b     -> g s:5000 d:4x4\n\
  ";
  let map = "\
d=17x17\n\
┌─────────────────────────────────────────────────┐\n\
│.  .  dg dt dt .  .  .  .  .  .  .  .  .  .  .  .│\n\
│ ┌────^──^──^──────────────────────────────────┐ │\n\
│ │    ^  ^  ^                                  │ │\n\
│.│ .  ║  ║  ║  .  .  .  .  .  .  .  .  .  .  . │.│\n\
│ │    ^  ^  ^                                  │ │\n\
│ │    ^  ^  ^                                  │ │\n\
│.│ .  ║  ║  ║  .  .  .  .  .  .  .  .  .  .  . │.│\n\
│ │    ^  ^  ^                                  │ │\n\
│ │   ┌^──^──^┐                                 │ │\n\
│s>>═>>1  1  1│ .  .  .  .  .  .  .  .  .  .  . │.│\n\
│w│   │       │                                 │ │\n\
│ │   │       │                                 │ │\n\
│s>>═>>1  1  1│ .  .  .  .  .  .  .  .  .  .  . │.│\n\
│s│   └───────┘                                 │ │\n\
│ │                                             │ │\n\
│.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
│ │                                             │ │\n\
│ │                                             │ │\n\
│.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
│ │                                             │ │\n\
│ │                                             │ │\n\
│.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
│ │                                             │ │\n\
│ │                                             │ │\n\
│.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
│ │                                             │ │\n\
│ │                                             │ │\n\
│.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
│ │                                             │ │\n\
│ │                                             │ │\n\
│.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
│ │                                             │ │\n\
│ │                                             │ │\n\
│.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
│ │                                             │ │\n\
│ │                                             │ │\n\
│.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
│ │                                             │ │\n\
│ │                                             │ │\n\
│.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
│ │                                             │ │\n\
│ │                                             │ │\n\
│.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
│ │                                             │ │\n\
│ │                                             │ │\n\
│.│ .  .  .  .  .  .  .  .  .  .  .  .  .  .  . │.│\n\
│ │                                             │ │\n\
│ └─────────────────────────────────────────────┘ │\n\
│.  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .│\n\
└─────────────────────────────────────────────────┘\n\
d1 = g\n\
d2 = t\n\
d3 = t\n\
s1 = w s:0 c:1\n\
m1 = s w   -> b s:5000\n\
s2 = s s:0 c:1\n\
os = w s:10 c:5\n\
os = s s:10 c:5\n\
od = g\n\
om = s w   -> b s:0 d:3x2\n\
om = b     -> g s:10 d:1x1\n\
om = b     -> g s:0 d:3x3\n\
om = b     -> g s:5000 d:4x4\n\
  ";

  let mut factory = create_factory(&mut options, &mut state, map.to_string());
  factory.changed = true;

  return ( options, state, factory );
}
